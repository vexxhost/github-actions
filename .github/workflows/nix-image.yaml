name: nix-image

on:
  workflow_call:
    inputs:
      runs-on:
        type: string
        required: false
        default: 'ubuntu-latest'
      push:
        type: boolean
        required: false
        default: false
    outputs:
      image-name:
        description: Image name
        value: ${{ jobs.build.outputs.image-name }}
      image-ref:
        description: Image reference
        value: ${{ jobs.build.outputs.image-ref }}

jobs:
  build:
    runs-on: ${{ inputs.runs-on }}
    timeout-minutes: 10
    steps:
      - uses: vexxhost/github-actions/nix-image@main
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          push: ${{ inputs.push }}
    outputs:
      image-name: ${{ steps.image-info.outputs.name }}
      image-ref: ${{ steps.image-info.outputs.ref }}
